<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Repaso — Fundamentos y Arquitectura de Redes | CITEN</title>
  <style>
    :root {
      --azul: #002855;
      --blanco: #ffffff;
      --ok: #2e7d32;
      --bad: #c62828;
      --bg: #f4f7fb;
      --card: #fff;
    }
    body {
      font-family: "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg);
      color: #222;
      margin: 0;
      padding: 0;
    }
    header {
      background: var(--azul);
      color: var(--blanco);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      padding: 18px 10px 10px 10px;
    }
    header .top-row {
      display:flex;
      align-items:center;
      gap:14px;
      width:100%;
      max-width:980px;
      padding:0 14px;
    }
    header img {
      width: 84px;
      height: auto;
      display:block;
    }
    header .titles {
      flex:1;
      text-align:left;
      color:var(--blanco);
    }
    header h1 {
      margin: 0;
      font-size: 1.15rem;
      font-weight: 700;
      letter-spacing: 0.2px;
    }
    header h2 {
      margin: 4px 0 0 0;
      font-size: 0.98rem;
      font-weight: 500;
    }
    header .creditos {
      font-size: 0.85rem;
      color: #d6e6ff;
      margin-top:8px;
    }

    .contenedor {
      max-width: 980px;
      margin: 18px auto;
      padding: 0 14px 40px 14px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      margin-bottom: 12px;
    }
    .controls label { font-weight:600; margin-right:6px }
    select, button, input[type=number] {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #cfd8e6;
      background: #fff;
      font-size: 0.95rem;
    }
    .modeGroup { display:flex; gap:12px; align-items:center }
    .modeGroup label { font-weight:500 }
    .pregunta {
      background: var(--card);
      border-radius: 10px;
      padding: 16px;
      margin-bottom: 12px;
      box-shadow: 0 2px 10px rgba(10, 20, 40, 0.04);
    }
    .pregunta h3 {
      margin: 0 0 8px;
      font-size: 1.05rem;
      color: var(--azul);
    }
    .opcion {
      display: block;
      padding: 8px;
      border-radius: 8px;
      margin: 6px 0;
      cursor: pointer;
    }
    .opcion.disabled { opacity: 0.7; pointer-events: none }
    .feedback { font-weight: 700; margin-top: 10px }
    .feedback.ok { color: var(--ok) }
    .feedback.bad { color: var(--bad) }
    .barra { height: 8px; background: #e6eefc; border-radius: 8px; overflow: hidden; margin: 12px 0 }
    .barra > span { display:block; height:100%; background: linear-gradient(90deg,#42a5f5,#1e88e5); width:0% }
    #resultado { background:#fff; padding:14px; border-radius:10px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); font-size:1rem; margin-top:10px }
    .notaError { color: var(--bad); font-weight:700; }
    footer { text-align:center; font-size:0.85rem; color:#555; margin-top:20px }
    @media (max-width:720px) {
      header .top-row { flex-direction:column; align-items:center; text-align:center }
      header .titles { text-align:center }
      .controls { flex-direction:column; align-items:stretch }
    }
  </style>
</head>
<body>
  <header>
    <div class="top-row">
      <img src="citen-escudo.gif" alt="Escudo CITEN" />
      <div class="titles">
        <h1>Centro de Instrucción Técnica y Entrenamiento Naval – CITEN</h1>
        <h2>Repaso — Fundamentos y Arquitectura de Redes</h2>
        <div class="creditos">Elaborado por José Carlos Sosa Villamonte — Instituto de Educación Superior Tecnológico Público Naval</div>
      </div>
    </div>
  </header>

  <div class="contenedor">
    <div class="controls">
      <label for="cantidadSelect">Cantidad (si no usa rango):</label>
      <select id="cantidadSelect">
        <option value="10">10 preguntas</option>
        <option value="20" selected>20 preguntas</option>
        <option value="50">50 preguntas</option>
      </select>

      <div style="display:flex;flex-direction:column;">
        <label style="font-weight:600">Modo de estudio:</label>
        <div class="modeGroup">
          <label><input type="radio" name="mode" value="secuencial" checked> Secuencial</label>
          <label><input type="radio" name="mode" value="aleatorio"> Aleatorio</label>
        </div>
      </div>

      <div style="display:flex;gap:8px;align-items:center;">
        <label for="startQ">Inicio (n°):</label>
        <input id="startQ" type="number" min="1" placeholder="1" style="width:84px" />
        <label for="endQ">Fin (n°):</label>
        <input id="endQ" type="number" min="1" placeholder="10" style="width:84px" />
      </div>

      <button id="btnIniciar">Iniciar</button>
      <button id="btnReiniciar" style="display:none">Reiniciar</button>
    </div>

    <div class="notaError" id="errorBox" style="display:none;margin-bottom:8px"></div>

    <div class="barra"><span id="barraProgreso"></span></div>
    <main id="main"></main>
    <div id="resultado" style="display:none"></div>
  </div>

  <footer>&copy; 2025 — CITEN | Fundamentos y Arquitectura de Redes</footer>


<script>
/*
  Versión extendida con subtítulo dinámico que muestra:
  - rango de preguntas del banco (inicio–fin)
  - o cantidad seleccionada + modo de estudio
*/

const RUTA_JSON = "preguntas.json";
let preguntasAll = [];
let preguntasActivas = [];
let respuestasUsuario = [];
let indicesOriginales = [];
let subtituloActual = "";

async function cargarPreguntas() {
  try {
    const resp = await fetch(RUTA_JSON);
    if (!resp.ok) throw new Error('HTTP ' + resp.status);
    const data = await resp.json();
    if (!Array.isArray(data)) throw new Error('Formato inválido: se esperaba un array');
    preguntasAll = data;
  } catch (err) {
    alert("Error al cargar preguntas.json: " + err.message);
  }
}

function mezclarArray(arr) {
  const a = arr.slice();
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function mostrarError(text) {
  const box = document.getElementById('errorBox');
  if (!text) {
    box.style.display = 'none';
    box.textContent = '';
  } else {
    box.style.display = 'block';
    box.textContent = text;
  }
}

function crearVista() {
  const cont = document.getElementById("main");
  cont.innerHTML = "";

  // Mostrar subtítulo dinámico antes de las preguntas
  if (subtituloActual) {
    const info = document.createElement("p");
    info.style.fontWeight = "600";
    info.style.color = "#1e3a8a";
    info.style.margin = "8px 0 14px 0";
    info.textContent = subtituloActual;
    cont.appendChild(info);
  }

  respuestasUsuario = Array(preguntasActivas.length).fill(null);
  updateProgreso();

  preguntasActivas.forEach((p, idx) => {
    const card = document.createElement("div");
    card.className = "pregunta";
    const titulo = document.createElement("h3");
    titulo.textContent = `${idx + 1}. [#${indicesOriginales[idx]}] ${p.pregunta}`;
    card.appendChild(titulo);

    p.opciones.forEach((opt, i) => {
      const label = document.createElement("label");
      label.className = "opcion";
      const radio = document.createElement("input");
      radio.type = "radio";
      radio.name = "pregunta_" + idx;
      radio.value = i;
      radio.onclick = () => onResponder(idx, i, card);
      label.appendChild(radio);
      label.appendChild(document.createTextNode(" " + opt));
      card.appendChild(label);
    });
    cont.appendChild(card);
  });
}

function onResponder(idx, idxSel, card) {
  const p = preguntasActivas[idx];
  const esCorrecta = idxSel === p.correcta;
  respuestasUsuario[idx] = { seleccion: idxSel, correcta: esCorrecta };

  const labels = card.querySelectorAll(".opcion");
  labels.forEach(l => l.classList.add("disabled"));

  const feedback = document.createElement("div");
  feedback.className = "feedback " + (esCorrecta ? "ok" : "bad");
  feedback.textContent = esCorrecta
    ? "✅ ¡Correcto!"
    : "❌ Incorrecto. Respuesta correcta: " + p.opciones[p.correcta];
  card.appendChild(feedback);

  labels.forEach((lab, i) => {
    if (i === p.correcta) lab.style.background = "#e8f5e9";
    if (i === idxSel && !esCorrecta) lab.style.background = "#ffebee";
  });

  updateProgreso();
  if (respuestasUsuario.every(r => r !== null)) mostrarResultado();
}

function updateProgreso() {
  const total = preguntasActivas.length;
  const respondidas = respuestasUsuario.filter(r => r !== null).length;
  const pct = total ? Math.round((respondidas / total) * 100) : 0;
  document.getElementById("barraProgreso").style.width = pct + "%";
}

function mostrarResultado() {
  const total = preguntasActivas.length;
  const correctas = respuestasUsuario.filter(r => r && r.correcta).length;
  const porcentaje = ((correctas / total) * 100).toFixed(1);
  const resultado = document.getElementById("resultado");
  resultado.style.display = "block";
  resultado.innerHTML = `
    <strong>Puntaje final:</strong> ${correctas} / ${total} (${porcentaje}%)<br>
    ${porcentaje >= 70 ? "✅ ¡Buen trabajo!" : "📘 Sigue repasando los temas de redes."}
  `;
  document.getElementById("btnReiniciar").style.display = "inline-block";
  document.getElementById("btnIniciar").style.display = "none";
}

function construirSesionDesdeRango(inicio, fin, modo) {
  const total = preguntasAll.length;
  const s = Math.max(1, Math.floor(inicio));
  const f = Math.min(total, Math.floor(fin));
  if (s > f) throw new Error("El número de inicio no puede ser mayor que el número final.");
  const pool = preguntasAll.slice(s - 1, f);
  const indices = Array.from({length: pool.length}, (_, i) => s + i);
  if (modo === 'aleatorio') {
    const combinado = indices.map((idx, i) => ({idx, pregunta: pool[i]}));
    const mezclado = mezclarArray(combinado);
    indicesOriginales = mezclado.map(x => x.idx);
    return mezclado.map(x => x.pregunta);
  } else {
    indicesOriginales = indices;
    return pool.slice();
  }
}

function iniciarSesion() {
  mostrarError(null);
  if (!preguntasAll || preguntasAll.length === 0) {
    mostrarError("No hay preguntas cargadas. Verifica preguntas.json.");
    return;
  }

  const modo = document.querySelector('input[name="mode"]:checked').value;
  const cantidad = parseInt(document.getElementById("cantidadSelect").value, 10);
  const startVal = document.getElementById("startQ").value.trim();
  const endVal = document.getElementById("endQ").value.trim();
  subtituloActual = "";

  if (startVal !== "" || endVal !== "") {
    if (startVal === "" || endVal === "") {
      mostrarError("Si usas rango, completa ambos campos: inicio y fin.");
      return;
    }
    const inicio = Number(startVal);
    const fin = Number(endVal);
    if (!Number.isInteger(inicio) || !Number.isInteger(fin) || inicio < 1 || fin < 1) {
      mostrarError("Los números de inicio y fin deben ser enteros positivos.");
      return;
    }
    if (inicio > fin) {
      mostrarError("El número de inicio no puede ser mayor que el número final.");
      return;
    }
    if (inicio > preguntasAll.length || fin > preguntasAll.length) {
      mostrarError(`Rango fuera de límites. El banco tiene ${preguntasAll.length} preguntas.`);
      return;
    }
    try {
      preguntasActivas = construirSesionDesdeRango(inicio, fin, modo);
      subtituloActual = `Preguntas del banco: ${inicio} – ${fin}  (modo: ${modo.charAt(0).toUpperCase() + modo.slice(1)})`;
    } catch (err) {
      mostrarError(err.message);
      return;
    }
  } else {
    if (!Number.isInteger(cantidad) || cantidad < 1) {
      mostrarError("Selecciona una cantidad válida (10, 20, 50).");
      return;
    }
    let pool = preguntasAll.map((p, i) => ({p, idx: i + 1}));
    if (modo === 'aleatorio') pool = mezclarArray(pool);
    const subset = pool.slice(0, Math.min(cantidad, pool.length));
    preguntasActivas = subset.map(x => x.p);
    indicesOriginales = subset.map(x => x.idx);
    subtituloActual = `Mostrando ${preguntasActivas.length} preguntas  (modo: ${modo.charAt(0).toUpperCase() + modo.slice(1)})`;
  }

  if (!preguntasActivas || preguntasActivas.length === 0) {
    mostrarError("No se seleccionaron preguntas para la sesión. Ajusta la cantidad o el rango.");
    return;
  }

  document.getElementById("resultado").style.display = "none";
  crearVista();
  document.getElementById("btnIniciar").style.display = "none";
  document.getElementById("btnReiniciar").style.display = "inline-block";
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function reiniciar() {
  preguntasActivas = [];
  respuestasUsuario = [];
  indicesOriginales = [];
  subtituloActual = "";
  document.getElementById("main").innerHTML = "";
  document.getElementById("resultado").style.display = "none";
  document.getElementById("btnReiniciar").style.display = "none";
  document.getElementById("btnIniciar").style.display = "inline-block";
  document.getElementById("barraProgreso").style.width = "0%";
  mostrarError(null);
}

document.getElementById("btnIniciar").addEventListener("click", iniciarSesion);
document.getElementById("btnReiniciar").addEventListener("click", reiniciar);
window.addEventListener("DOMContentLoaded", async () => { await cargarPreguntas(); });
</script>


</body>
</html>
