<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Repaso CITEN — Selección de Curso</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f7fb;
      color: #222;
    }
    header {
      background: #002855;
      color: white;
      padding: 20px;
      text-align: center;
    }
    header h1 { margin: 0; font-size: 1.3rem; }
    .contenedor {
      max-width: 960px;
      margin: 20px auto;
      padding: 0 16px;
    }
    .card {
      background: #fff;
      border-radius: 8px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    label { font-weight: 600; display: block; margin-top: 12px; }
    select, input[type=number] {
      padding: 8px;
      width: 100%;
      max-width: 300px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .mode-group {
      display: flex;
      gap: 20px;
      margin-top: 10px;
    }
    .mode-group label {
      font-weight: normal;
    }
    .range-fields {
      display: flex;
      gap: 10px;
      margin-top: 12px;
      display: none;
    }
    .range-fields input {
      width: 100px;
    }
    button {
      margin-top: 20px;
      padding: 10px 16px;
      border: none;
      background: #002855;
      color: white;
      border-radius: 6px;
      cursor: pointer;
    }
    .barra { height: 8px; background: #e6eefc; border-radius: 8px; overflow: hidden; margin: 12px 0 }
    .barra > span { display:block; height:100%; background: linear-gradient(90deg,#42a5f5,#1e88e5); width:0% }
    .feedback { font-weight: 700; margin-top: 10px }
    .feedback.ok { color: #2e7d32; }
    .feedback.bad { color: #c62828; }
  </style>
</head>
<body>
<header>
  <h1>Repaso Interactivo CITEN</h1>
</header>
<div class="contenedor">
  <div class="card">
    <label for="cursoSelect">Selecciona el curso:</label>
    <select id="cursoSelect">
      <option value="preguntas.json">FUNDAMENTOS DE REDES</option>
      <option value="banco_preguntas_SO.json">SISTEMAS OPERATIVOS</option>
    </select>

    <label>Modo de estudio:</label>
    <div class="mode-group">
      <label><input type="radio" name="modo" value="secuencial"> Secuencial</label>
      <label><input type="radio" name="modo" value="aleatorio"> Aleatorio</label>
    </div>

    <div class="range-fields" id="rangeFields">
      <div>
        <label for="inicio">Pregunta inicial:</label>
        <input type="number" id="inicio" min="1" />
      </div>
      <div>
        <label for="fin">Pregunta final:</label>
        <input type="number" id="fin" min="1" />
      </div>
    </div>

    <button onclick="cargarBanco()">Iniciar Cuestionario</button>
    <button onclick="reiniciarCuestionario()" id="btnReiniciar" style="display:none; margin-left:10px; background:#999;">Reiniciar</button>
  </div>

  <div class="barra"><span id="barraProgreso"></span></div>

  <div id="cuestionario" class="card"></div>
  <div id="resultado" class="card" style="display:none"></div>
</div>
<script>
  const cursoSelect = document.getElementById('cursoSelect');
  const rangeFields = document.getElementById('rangeFields');
  const radios = document.querySelectorAll('input[name="modo"]');
  const btnReiniciar = document.getElementById("btnReiniciar");
  let preguntas = [];
  let respuestas = [];

  radios.forEach(r => r.addEventListener('change', () => {
    if (document.querySelector('input[name="modo"]:checked')) {
      rangeFields.style.display = 'flex';
    }
  }));

  async function cargarBanco() {
    const archivo = cursoSelect.value;
    try {
      const resp = await fetch(archivo);
      if (!resp.ok) throw new Error("No se pudo cargar el archivo " + archivo);
      const data = await resp.json();

      const inicio = parseInt(document.getElementById("inicio").value || "1");
      const fin = parseInt(document.getElementById("fin").value || data.length);
      const modo = document.querySelector("input[name='modo']:checked")?.value || "secuencial";

      preguntas = data.slice(inicio - 1, fin);
      if (modo === "aleatorio") preguntas = preguntas.sort(() => Math.random() - 0.5);
      respuestas = Array(preguntas.length).fill(null);

      mostrarPreguntas();
      btnReiniciar.style.display = "inline-block";
    } catch (e) {
      alert(e.message);
    }
  }

  function mostrarPreguntas() {
    const cont = document.getElementById("cuestionario");
    cont.innerHTML = "";
    preguntas.forEach((p, i) => {
      const div = document.createElement("div");
      div.classList.add("pregunta");
      div.innerHTML = `<strong>${i + 1}. ${p.pregunta}</strong><br>`;

      p.opciones.forEach((op, idx) => {
        const label = document.createElement("label");
        label.className = "opcion";
        const radio = document.createElement("input");
        radio.type = "radio";
        radio.name = `p${i}`;
        radio.value = idx;
        radio.onclick = () => responder(i, idx, div);
        label.appendChild(radio);
        label.appendChild(document.createTextNode(" " + op));
        div.appendChild(label);
        div.appendChild(document.createElement("br"));
      });

      cont.appendChild(div);
    });
    actualizarBarra();
    document.getElementById("resultado").style.display = "none";
  }

  function responder(idx, sel, card) {
    const correcta = preguntas[idx].correcta;
    const correcto = sel === correcta;
    respuestas[idx] = correcto;

    const feedback = document.createElement("div");
    feedback.className = "feedback " + (correcto ? "ok" : "bad");
    feedback.textContent = correcto ? "✅ ¡Correcto!" : `❌ Incorrecto. Respuesta correcta: ${preguntas[idx].opciones[correcta]}`;

    const opciones = card.querySelectorAll("input[type='radio']");
    opciones.forEach(o => o.disabled = true);

    card.appendChild(feedback);
    actualizarBarra();
    if (respuestas.every(r => r !== null)) mostrarResultado();
  }

  function actualizarBarra() {
    const total = respuestas.length;
    const hechas = respuestas.filter(r => r !== null).length;
    const pct = total ? Math.round((hechas / total) * 100) : 0;
    document.getElementById("barraProgreso").style.width = pct + "%";
  }

  function mostrarResultado() {
    const total = respuestas.length;
    const bien = respuestas.filter(r => r).length;
    const pct = ((bien / total) * 100).toFixed(1);
    const r = document.getElementById("resultado");
    r.style.display = "block";
    r.innerHTML = `<strong>Puntaje final:</strong> ${bien}/${total} (${pct}%)<br>` +
      (pct >= 70 ? "✅ ¡Buen trabajo!" : "📘 Sigue repasando los temas.");
  }

  function reiniciarCuestionario() {
    document.getElementById("inicio").value = "";
    document.getElementById("fin").value = "";
    document.getElementById("cuestionario").innerHTML = "";
    document.getElementById("resultado").style.display = "none";
    document.getElementById("barraProgreso").style.width = "0%";
    btnReiniciar.style.display = "none";
  }
</script>
</body>
</html>